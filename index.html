<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>é›¶æœåŠ¡å™¨ç§é“¾Â·æ»¡è¶³ä½ å…¨éƒ¨éœ€æ±‚æœ€ç»ˆç‰ˆ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#0a0f1e;color:#e6e9f0;padding:15px}
.game{max-width:420px;margin:0 auto;background:#121a2f;border-radius:16px;overflow:hidden}
.head{background:#1b2542;padding:12px;text-align:center;font-weight:bold}
.panel{padding:15px}
.btn{width:100%;padding:12px;margin:6px 0;border:none;border-radius:10px;background:#2d4bff;color:#fff;font-weight:bold;cursor:pointer}
.btn-success{background:#00b850}
.btn-warning{background:#ff9500}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;background:#1e273e;color:#fff}
.log{background:#0d1324;padding:12px;border-radius:8px;margin:10px 0;height:110px;overflow-y:auto;font-size:13px}
.bag{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:10px 0}
.item{background:#1b2542;padding:10px;border-radius:8px;text-align:center;font-size:12px}
.hr{height:1px;background:#1e273e;margin:10px 0}
</style>
</head>
<body>
<div class="game">
  <div class="head">é›¶æœåŠ¡å™¨ç§é“¾Â·æœ€ç»ˆå®Œæ•´ç‰ˆ</div>
  <div class="panel">
    <button class="btn" onclick="createWallet()">ğŸª™ åˆ›å»ºé’±åŒ…ï¼ˆåŠ©è®°è¯ï¼‰</button>
    <button class="btn" onclick="showMnemonic()">ğŸ“„ æŸ¥çœ‹åŠ©è®°è¯</button>
    <input id="restoreMne" placeholder="ç²˜è´´12ä¸ªå•è¯æ¢å¤è´¦å·">
    <button class="btn" onclick="restoreAccount()">âœ… æ¢å¤è´¦å·</button>
    <div class="hr"></div>
    <button class="btn-success" onclick="fight()">âš”ï¸ æ‰“æ€ªçˆ†è£…å¤‡</button>
    <div class="hr"></div>
    <input id="toAddr" placeholder="å¯¹æ–¹åœ°å€">
    <input id="itemName" placeholder="é“å…·åç§°">
    <button class="btn-warning" onclick="sendItem()">ğŸ“¤ å‘é€é“å…·</button>
    <div class="hr"></div>
    <div>ğŸ’ æˆ‘çš„èƒŒåŒ…ï¼ˆç›´æ¥çœ‹è¿™é‡Œï¼‰</div>
    <div class="bag" id="bag"></div>
    <div>æ—¥å¿—</div>
    <div class="log" id="log"></div>
  </div>
</div>

<script>
const logBox = document.getElementById('log');
const bagBox = document.getElementById('bag');
const KEY_MNE = 'mne';
const KEY_ADDR = 'addr';

const words = "apple banana cherry date elder fig grape honey ice juice kite lemon mango nut orange pear queen rose sun tomato umbrella van water xmas yellow zebra".split(' ');

function print(text) {
  logBox.innerText = `[${new Date().toLocaleTimeString()}] ${text}\n` + logBox.innerText;
}

// ========================== è´¦å·ç³»ç»Ÿ ==========================
function createWallet() {
  const mne = Array(12).fill(0).map(() => words[Math.random() * words.length | 0]).join(' ');
  const addr = mne.replace(/\s/g, '').slice(-16);
  localStorage.setItem(KEY_MNE, mne);
  localStorage.setItem(KEY_ADDR, addr);
  print('âœ… é’±åŒ…å·²åˆ›å»º');
  print('ğŸ“ åœ°å€ï¼š' + addr);
  showBag();
}

function showMnemonic() {
  const mne = localStorage.getItem(KEY_MNE);
  mne ? print('ğŸ“‹ åŠ©è®°è¯ï¼š' + mne) : print('âŒ æœªåˆ›å»ºé’±åŒ…');
}

function restoreAccount() {
  const input = document.getElementById('restoreMne').value.trim();
  if (input.split(/\s+/).length !== 12) return print('âŒ è¯·è¾“å…¥12ä¸ªå•è¯');
  const addr = input.replace(/\s/g, '').slice(-16);
  localStorage.setItem(KEY_MNE, input);
  localStorage.setItem(KEY_ADDR, addr);
  print('âœ… è´¦å·æ¢å¤æˆåŠŸ');
  print('ğŸ“ åœ°å€ï¼š' + addr);
  showBag();
}

function getMe() {
  return localStorage.getItem(KEY_ADDR);
}

// ========================== æœ¬åœ°ç§é“¾ï¼ˆä¸ä¸Šå…¬é“¾ã€é›¶æœåŠ¡å™¨ï¼‰ ==========================
let chain = JSON.parse(localStorage.getItem('chain') || '[]');

function saveChain() {
  localStorage.setItem('chain', JSON.stringify(chain));
}

// ========================== æ‰“æ€ª ==========================
function fight() {
  const me = getMe();
  if (!me) return print('âŒ å…ˆåˆ›å»ºé’±åŒ…');
  const items = ['é“å‰‘', 'å¸ƒè¡£', 'æˆ’æŒ‡', 'é´å­', 'è¯æ°´'];
  const name = items[Math.random() * 5 | 0];
  chain.push({ type: 'item', owner: me, name: name, uuid: Date.now() });
  saveChain();
  print('ğŸ è·å¾—ï¼š' + name);
  showBag();
}

// ========================== èƒŒåŒ…ï¼ˆç›´æ¥æ˜¾ç¤ºæ‰€æœ‰é“å…·ï¼‰ ==========================
function showBag() {
  const me = getMe();
  bagBox.innerHTML = '';
  if (!me) return;
  const myItems = chain.filter(i => i.type === 'item' && i.owner === me);
  myItems.forEach(it => {
    const d = document.createElement('div');
    d.className = 'item';
    d.innerText = it.name;
    bagBox.appendChild(d);
  });
}

// ========================== é“å…·äº¤æ˜“ ==========================
function sendItem() {
  const me = getMe();
  const to = document.getElementById('toAddr').value.trim();
  const name = document.getElementById('itemName').value.trim();
  if (!me || !to || !name) return print('âŒ ä¿¡æ¯ä¸å…¨');

  const item = chain.find(i => i.type === 'item' && i.owner === me && i.name === name);
  if (!item) return print('âŒ ä½ æ²¡æœ‰è¯¥é“å…·');

  item.owner = to;
  saveChain();
  print('âœ… å‘é€æˆåŠŸï¼š' + name);
  showBag();
}

// åˆå§‹åŒ–
showBag();
</script>
</body>
</html>
