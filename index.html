<!DOCTYPE html>
<html lang="UTF-8">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>åˆ·æ–°ä¸ä¸¢Â·å¿«ç…§ç§é“¾Â·æœ€ç»ˆç‰ˆ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#0a0f1e;color:#e6e9f0;padding:15px}
.game{max-width:420px;margin:0 auto;background:#121a2f;border-radius:16px;overflow:hidden}
.head{background:#1b2542;padding:12px;text-align:center;font-weight:bold}
.panel{padding:15px}
.btn{width:100%;padding:12px;margin:6px 0;border:none;border-radius:10px;background:#2d4bff;color:#fff;font-weight:bold}
input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;background:#1e273e;color:#fff}
.log{background:#0d1324;padding:12px;border-radius:8px;margin:10px 0;height:110px;overflow-y:auto;font-size:13px}
.bag{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:10px 0}
.item{background:#1b2542;padding:10px;border-radius:8px;text-align:center}
.hr{height:1px;background:#1e273e;margin:10px 0}
</style>
</head>
<body>
<div class="game">
  <div class="head">åˆ·æ–°ä¸ä¸¢Â·å¿«ç…§ç§é“¾</div>
  <div class="panel">
    <button class="btn" onclick="createWallet()">ğŸª™ åˆ›å»ºé’±åŒ…</button>
    <button class="btn" onclick="showMnemonic()">ğŸ“„ åŠ©è®°è¯</button>
    <input id="mneInput" placeholder="12ä¸ªå•è¯æ¢å¤è´¦å·">
    <button class="btn" onclick="restoreAccount()">âœ… æ¢å¤è´¦å·</button>
    <div class="hr"></div>
    <button class="btn" onclick="fight()">âš”ï¸ æ‰“æ€ª</button>
    <div class="hr"></div>
    <input id="toAddr" placeholder="å¯¹æ–¹åœ°å€">
    <input id="itemName" placeholder="é“å…·å">
    <button class="btn" onclick="sendItem()">ğŸ“¤ å‘é€é“å…·</button>
    <div class="hr"></div>
    <div>ğŸ’ æˆ‘çš„èƒŒåŒ…</div>
    <div class="bag" id="bag"></div>
    <div>æ—¥å¿—</div>
    <div class="log" id="log"></div>
  </div>
</div>

<script>
const logBox = document.getElementById('log');
const bagBox = document.getElementById('bag');
const KEY_MNE = 'game_mne';
const KEY_ADDR = 'game_addr';
// å¿«ç…§å­˜åœ¨æœ¬åœ°ï¼Œæ°¸ä¹…ä¿å­˜ï¼Œåˆ·æ–°ä¸ä¸¢
const SNAPSHOT_KEY = 'game_snapshot';

const words = "apple banana cherry date elder fig grape honey ice juice kite lemon mango nut orange pear queen rose sun tomato umbrella van water xmas yellow zebra".split(' ');

function print(text) {
  logBox.innerText = `[${new Date().toLocaleTimeString()}] ${text}\n` + logBox.innerText;
}

// ============== 1. è´¦å·ç³»ç»Ÿ ==============
function createWallet() {
  const mne = Array(12).fill(0).map(()=>words[Math.random()*words.length|0]).join(' ');
  const addr = mne.replace(/\s+/g, '').slice(-16);
  localStorage.setItem(KEY_MNE, mne);
  localStorage.setItem(KEY_ADDR, addr);
  print('âœ… é’±åŒ…å·²åˆ›å»º');
  print('ğŸ“ åœ°å€ï¼š' + addr);
  loadSnapshot();
  showBag();
}

function showMnemonic() {
  const mne = localStorage.getItem(KEY_MNE);
  mne ? print('ğŸ“‹ åŠ©è®°è¯ï¼š' + mne) : print('âŒ å…ˆåˆ›å»ºé’±åŒ…');
}

function restoreAccount() {
  const input = document.getElementById('mneInput').value.trim();
  if (input.split(/\s+/).length !== 12) return print('âŒ è¯·è¾“å…¥12ä¸ªå•è¯');
  const addr = input.replace(/\s+/g, '').slice(-16);
  localStorage.setItem(KEY_MNE, input);
  localStorage.setItem(KEY_ADDR, addr);
  print('âœ… è´¦å·æ¢å¤æˆåŠŸï¼');
  print('ğŸ“ åœ°å€ï¼š' + addr);
  loadSnapshot();
  showBag();
}

function getMyAddr() {
  return localStorage.getItem(KEY_ADDR);
}

// ============== 2. å¿«ç…§æ ¸å¿ƒï¼ˆæ°¸ä¸è†¨èƒ€ã€åˆ·æ–°ä¸ä¸¢ï¼‰ ==============
let state = {};

// åŠ è½½å¿«ç…§
function loadSnapshot() {
  try {
    state = JSON.parse(localStorage.getItem(SNAPSHOT_KEY)) || {};
  } catch (e) {
    state = {};
  }
}

// ä¿å­˜å¿«ç…§
function saveSnapshot() {
  localStorage.setItem(SNAPSHOT_KEY, JSON.stringify(state));
}

// ============== 3. æ‰“æ€ª ==============
function fight() {
  const me = getMyAddr();
  if (!me) return print('âŒ å…ˆåˆ›å»ºé’±åŒ…');
  loadSnapshot();
  const items = ['é“å‰‘', 'å¸ƒè¡£', 'æˆ’æŒ‡', 'é´å­', 'è¯æ°´'];
  const name = items[Math.random() * 5 | 0];
  state[me] = state[me] || [];
  state[me].push(name);
  saveSnapshot();
  print('ğŸ è·å¾—ï¼š' + name);
  showBag();
}

// ============== 4. èƒŒåŒ…ï¼ˆåˆ·æ–°æ°¸è¿œä¸ä¸¢ï¼‰ ==============
function showBag() {
  const me = getMyAddr();
  bagBox.innerHTML = '';
  if (!me) return;
  loadSnapshot();
  const myItems = state[me] || [];
  myItems.forEach(name => {
    const d = document.createElement('div');
    d.className = 'item';
    d.innerText = name;
    bagBox.appendChild(d);
  });
}

// ============== 5. å‘é€é“å…· ==============
function sendItem() {
  const me = getMyAddr();
  const to = document.getElementById('toAddr').value.trim();
  const name = document.getElementById('itemName').value.trim();
  if (!me || !to || !name) return print('âŒ ä¿¡æ¯ä¸å…¨');

  loadSnapshot();
  if (!state[me] || !state[me].includes(name)) return print('âŒ ä½ æ²¡æœ‰è¯¥é“å…·');

  // ç§»é™¤æˆ‘çš„é“å…·
  state[me].splice(state[me].indexOf(name), 1);
  // å‘ç»™å¯¹æ–¹
  state[to] = state[to] || [];
  state[to].push(name);
  
  saveSnapshot();
  print('âœ… å‘é€æˆåŠŸï¼š' + name);
  showBag();
}

// åˆå§‹åŒ–ï¼šä¸€è¿›æ¥å°±åŠ è½½å¿«ç…§ï¼Œä¿è¯åˆ·æ–°ä¸ä¸¢
loadSnapshot();
showBag();
</script>
</body>
</html>
